<div class="row">
  <div class="col-12">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2><i class="fas fa-calendar me-2"></i>活动管理</h2>
      <button class="btn btn-primary" routerLink="/events/new">
        <i class="fas fa-plus me-1"></i>新建活动
      </button>
    </div>

    <!-- 筛选表单 -->
    <div class="card mb-4">
      <div class="card-body">
        <form #filterForm="ngForm" (ngSubmit)="applyFilters()">
          <div class="row g-3">
            <div class="col-md-3">
              <label class="form-label">日期</label>
              <input type="date" class="form-control" [(ngModel)]="filters.date" name="date">
            </div>
            <div class="col-md-3">
              <label class="form-label">城市</label>
              <input type="text" class="form-control" [(ngModel)]="filters.city" name="city" placeholder="输入城市">
            </div>
            <div class="col-md-3">
              <label class="form-label">类别</label>
              <select class="form-select" [(ngModel)]="filters.categoryId" name="categoryId">
                <option value="">所有类别</option>
                <option *ngFor="let category of categories" [value]="category.id">
                  {{ category.name }}
                </option>
              </select>
            </div>
            <div class="col-md-3">
              <label class="form-label">搜索</label>
              <input type="text" class="form-control" [(ngModel)]="filters.search" name="search" placeholder="搜索活动">
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-12">
              <button type="submit" class="btn btn-primary me-2">
                <i class="fas fa-search me-1"></i>筛选
              </button>
              <button type="button" class="btn btn-secondary" (click)="clearFilters()">
                <i class="fas fa-times me-1"></i>清除
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>

    <!-- 活动列表 -->
    <div class="card">
      <div class="card-body">
        <div *ngIf="loading" class="text-center py-4">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">加载中...</span>
          </div>
        </div>

        <div *ngIf="!loading && events.length === 0" class="text-center py-4">
          <i class="fas fa-calendar-times fa-3x text-muted mb-3"></i>
          <h5 class="text-muted">暂无活动</h5>
          <p class="text-muted">点击"新建活动"按钮来创建第一个活动</p>
        </div>

        <div class="table-responsive" *ngIf="!loading && events.length > 0">
          <table class="table table-hover">
            <thead class="table-light">
              <tr>
                <th>标题</th>
                <th>城市/州</th>
                <th>开始时间</th>
                <th>类别</th>
                <th>价格</th>
                <th>操作</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let event of events">
                <td>
                  <strong>{{ event.title }}</strong>
                  <br>
                  <small class="text-muted">{{ event.org_name }}</small>
                </td>
                <td>{{ event.city }}, {{ event.state }}</td>
                <td>{{ event.start_datetime | date:'yyyy-MM-dd HH:mm' }}</td>
                <td>
                  <span class="badge bg-secondary">{{ event.category }}</span>
                </td>
                <td>
                  <span *ngIf="event.is_free" class="badge bg-success">免费</span>
                  <span *ngIf="!event.is_free" class="text-muted">
                    {{ (event.ticket_price_cents || 0) / 100 | currency }}
                  </span>
                </td>
                <td>
                  <div class="btn-group btn-group-sm">
                    <button class="btn btn-outline-primary" [routerLink]="['/events', event.id]">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="btn btn-outline-secondary" [routerLink]="['/events/edit', event.id]">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-outline-danger" (click)="deleteEvent(event.id!)">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
