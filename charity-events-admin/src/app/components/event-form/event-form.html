<div class="row justify-content-center">
  <div class="col-lg-10">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h2>
        <i class="fas" [class.fa-plus]="!eventId" [class.fa-edit]="eventId"></i>
        {{ eventId ? '编辑活动' : '新建活动' }}
      </h2>
      <button class="btn btn-outline-secondary" routerLink="/events">
        <i class="fas fa-arrow-left me-1"></i>返回列表
      </button>
    </div>

    <div class="card">
      <div class="card-body">
        <form #eventForm="ngForm" (ngSubmit)="onSubmit()" *ngIf="categories.length > 0">
          
          <!-- 基本信息 -->
          <div class="row mb-4">
            <div class="col-12">
              <h5 class="border-bottom pb-2">基本信息</h5>
            </div>
            
            <div class="col-md-6 mb-3">
              <label class="form-label required">活动标题</label>
              <input type="text" class="form-control" 
                     [(ngModel)]="event.title" 
                     name="title" 
                     required 
                     #title="ngModel">
              <div class="text-danger" *ngIf="title.invalid && title.touched">
                活动标题是必填项
              </div>
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label required">类别</label>
              <select class="form-select" 
                      [(ngModel)]="event.category_id" 
                      name="category_id" 
                      required 
                      #categoryId="ngModel">
                <option value="">选择类别</option>
                <option *ngFor="let category of categories" [value]="category.id">
                  {{ category.name }}
                </option>
              </select>
              <div class="text-danger" *ngIf="categoryId.invalid && categoryId.touched">
                类别是必选项
              </div>
            </div>

            <div class="col-12 mb-3">
              <label class="form-label required">活动描述</label>
              <textarea class="form-control" 
                        rows="4" 
                        [(ngModel)]="event.description" 
                        name="description" 
                        required 
                        #description="ngModel"></textarea>
              <div class="text-danger" *ngIf="description.invalid && description.touched">
                活动描述是必填项
              </div>
            </div>
          </div>

          <!-- 地点信息 -->
          <div class="row mb-4">
            <div class="col-12">
              <h5 class="border-bottom pb-2">地点信息</h5>
            </div>
            
            <div class="col-md-6 mb-3">
              <label class="form-label required">城市</label>
              <input type="text" class="form-control" 
                     [(ngModel)]="event.city" 
                     name="city" 
                     required 
                     #city="ngModel">
              <div class="text-danger" *ngIf="city.invalid && city.touched">
                城市是必填项
              </div>
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label required">州/省</label>
              <input type="text" class="form-control" 
                     [(ngModel)]="event.state" 
                     name="state" 
                     required 
                     #state="ngModel">
              <div class="text-danger" *ngIf="state.invalid && state.touched">
                州/省是必填项
              </div>
            </div>
          </div>

          <!-- 时间信息 -->
          <div class="row mb-4">
            <div class="col-12">
              <h5 class="border-bottom pb-2">时间信息</h5>
            </div>
            
            <div class="col-md-6 mb-3">
              <label class="form-label required">开始时间</label>
              <input type="datetime-local" class="form-control" 
                     [(ngModel)]="event.start_datetime" 
                     name="start_datetime" 
                     required 
                     #startDatetime="ngModel">
              <div class="text-danger" *ngIf="startDatetime.invalid && startDatetime.touched">
                开始时间是必填项
              </div>
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label required">结束时间</label>
              <input type="datetime-local" class="form-control" 
                     [(ngModel)]="event.end_datetime" 
                     name="end_datetime" 
                     required 
                     #endDatetime="ngModel">
              <div class="text-danger" *ngIf="endDatetime.invalid && endDatetime.touched">
                结束时间是必填项
              </div>
            </div>
          </div>

          <!-- 票价信息 -->
          <div class="row mb-4">
            <div class="col-12">
              <h5 class="border-bottom pb-2">票价信息</h5>
            </div>
            
            <div class="col-md-6 mb-3">
              <div class="form-check">
                <input class="form-check-input" 
                       type="checkbox" 
                       [(ngModel)]="event.is_free" 
                       name="is_free"
                       (change)="onFreeChange()">
                <label class="form-check-label">免费活动</label>
              </div>
            </div>

            <div class="col-md-6 mb-3" *ngIf="!event.is_free">
              <label class="form-label required">票价 (分)</label>
              <input type="number" class="form-control" 
                     [(ngModel)]="event.ticket_price_cents" 
                     name="ticket_price_cents" 
                     min="0" 
                     [required]="!event.is_free"
                     #ticketPrice="ngModel">
              <div class="text-danger" *ngIf="ticketPrice.invalid && ticketPrice.touched">
                票价是必填项
              </div>
              <small class="text-muted">输入以分为单位的价格 (100分 = 1元)</small>
            </div>
          </div>

          <!-- 其他信息 -->
          <div class="row mb-4">
            <div class="col-12">
              <h5 class="border-bottom pb-2">其他信息</h5>
            </div>
            
            <div class="col-md-6 mb-3">
              <label class="form-label required">组织ID</label>
              <input type="number" class="form-control" 
                     [(ngModel)]="event.org_id" 
                     name="org_id" 
                     required 
                     min="1"
                     #orgId="ngModel">
              <div class="text-danger" *ngIf="orgId.invalid && orgId.touched">
                组织ID是必填项且必须大于0
              </div>
            </div>

            <div class="col-md-6 mb-3">
              <label class="form-label">英雄图片URL</label>
              <input type="url" class="form-control" 
                     [(ngModel)]="event.hero_image_url" 
                     name="hero_image_url">
            </div>
          </div>

          <!-- 提交按钮 -->
          <div class="row">
            <div class="col-12">
              <button type="submit" 
                      class="btn btn-primary me-2" 
                      [disabled]="eventForm.invalid || loading">
                <span *ngIf="loading" class="spinner-border spinner-border-sm me-2"></span>
                <i class="fas" [class.fa-save]="!loading" [class.fa-spinner]="loading"></i>
                {{ eventId ? '更新活动' : '创建活动' }}
              </button>
              <button type="button" class="btn btn-secondary" routerLink="/events">
                取消
              </button>
            </div>
          </div>
        </form>

        <div *ngIf="categories.length === 0" class="text-center py-4">
          <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">加载中...</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>